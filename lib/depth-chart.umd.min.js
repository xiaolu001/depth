(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["depth-chart"]=e():t["depth-chart"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fd77")}({"29ee":function(t){t.exports=JSON.parse('{"depth":{"background":"#161C2C","buyColor":"#159B74","sellColor":"#BC2351","globalAlpha":0.4,"lineWidth":2},"xAxis":{"height":"25","line":{"color":"#fff","size":0.5},"tickLine":{"color":"#fff","size":0.5}},"yAxis":{"width":60,"line":{"color":"#fff","size":0.5},"tickLine":{"color":"#fff","size":0.5},"position":"rigth","tickTextPosition":"outside"}}')},c53a:function(t){t.exports=JSON.parse('{"zh":{"price":"委托价","sum":"累计"},"en":{"price":"Price","sum":"Sum"},"ko":{"price":"가격","sum":"루계"},"ja":{"price":"価格","sum":"累計"},"zh_TW":{"price":"價格","sum":"累計"}}')},e67d:function(t,e){(function(t){var e="currentScript",i=t.getElementsByTagName("script");e in t||Object.defineProperty(t,e,{get:function(){try{throw new Error}catch(s){var t,e=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(s.stack)||[!1])[1];for(t in i)if(i[t].src==e||"interactive"==i[t].readyState)return i[t];return null}}})})(document)},fd77:function(t,e,i){"use strict";var s;(i.r(e),"undefined"!==typeof window)&&(i("e67d"),(s=window.document.currentScript)&&(s=s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(i.p=s[1]));class a{constructor(){this.contentRect={left:0,right:0,top:0,bottom:0},this.height=0,this.width=0}setDimensions(t,e,i,s,a,r){this.width=t,this.height=e,this.contentRect.left=i,this.contentRect.right=s,this.contentRect.top=a,this.contentRect.bottom=r}contentTop(){return this.contentRect.top}contentLeft(){return this.contentRect.left}contentRight(){return this.width-this.contentRect.right}contentBottom(){return this.height-this.contentRect.bottom}getContentCenter(){const t={};return t.x=(this.contentLeft()+this.contentRight())/2,t.y=(this.contentTop()+this.contentBottom())/2,t}}var r=a;class n{constructor(){this.viewPortHandler=new r}init(t){if(t){const e=document.createElement("canvas");e.style.position="absolute",e.style.right="0",e.style.left="0",this.canvasDom=e,this.ctx=this.canvasDom.getContext("2d"),t.appendChild(this.canvasDom)}}setChartDimensions(t,e,i,s,a,r=0,n=25){this.clearCanvas(),this.canvasDom.style.top=`${t}px`,this.canvasDom.style.width=`${e}px`,this.canvasDom.style.height=`${i}px`,this.canvasDom.width=e,this.canvasDom.height=i,this.viewPortHandler.setDimensions(e,i,s,a,r,n),this.draw()}clearCanvas(){this.ctx.clearRect(0,0,this.viewPortHandler.width,this.viewPortHandler.height)}flush(){this.clearCanvas(),this.draw()}draw(){}}var o=n;class l{constructor(t,e,i){this.viewPortHandler=t,this.dataProvider=e,this.interval=i}}var h=l;class c extends h{constructor(t,e,i){super(t,e,i)}}var d=c;class f extends d{renderAxisLine(t,e){t.strokeStyle=e.line.color,t.lineWidth=e.line.size,t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentBottom()),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentBottom()),t.stroke(),t.closePath()}renderTickLines(t,e){t.lineWidth=e.tickLine.size,t.strokeStyle=e.tickLine.color,t.textAlign="center",t.font="12px sans-serif",t.fillStyle=e.tickLine.color;const i=this.viewPortHandler.contentBottom(),s=i+5,a=this.viewPortHandler.contentRight()/16;let r=0;const n=2*a,o=2*this.dataProvider.adjacent(),l=o/16,h=2*l,c=this.dataProvider.getPriceDecimal();for(let d=0;d<8;d++){const e=r+a+d*n,o=this.dataProvider.minPrice()+l+d*h;t.beginPath(),t.moveTo(e,i),t.lineTo(e,s),t.fillText(o.toFixed(c),e,s+10),t.stroke(),t.closePath()}}}var u=f;class p extends d{renderAxisLine(t,e){t.strokeStyle=e.line.color,t.lineWidth=e.line.size,t.beginPath(),"left"===e.position?(t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentTop()),t.lineTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentBottom())):(t.moveTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentTop()),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentBottom())),t.stroke(),t.closePath()}renderTickLines(t,e){t.lineWidth=e.tickLine.size,t.strokeStyle=e.tickLine.color,t.font="12px sans-serif",t.textBaseline="middle",t.textAlign="left",t.fillStyle=e.tickLine.color;const i=5;let s,a;"left"===e.position?(s=this.viewPortHandler.contentLeft(),a="outside"===e.tickTextPosition?s-i:s+i):(s=this.viewPortHandler.contentRight(),a="outside"===e.tickTextPosition?s+i:s-i);const r=this.viewPortHandler.contentBottom(),n=this.dataProvider.maxVol(),o=r/16*3,l=n/16*3;for(let h=0;h<6;h++){const e=r-h*o,i=this.renderTickLinesValue(h*l);t.beginPath(),t.moveTo(s,e),t.lineTo(a,e),t.fillText(i,a+5,e),t.stroke(),t.closePath()}}renderTickLinesValue(t){if(t>1e3&&t<1e6){let e=(t/1e3).toString();return`${this.decimal(e)}K`}if(t>=1e6){let e=(t/1e6).toString();return`${this.decimal(e)}M`}return this.decimal(t.toString())}decimal(t){if(t.indexOf(".")>-1){let e=t.substr(0,5);return"."===e.charAt(e.length-1)?t.substr(0,4):e}return t.substr(0,4)}}var v=p;class m extends h{renderDraw(t,e){const i=this.dataProvider.maxVol(),s=(this.viewPortHandler.contentRight()-this.interval)/2,a=this.viewPortHandler.contentBottom(),r=this.dataProvider.leftData,n=this.dataProvider.rightData,o=r.length,l=n.length,h=s/o,c=s/l,{background:d}=e;this.drawBg(t,this.viewPortHandler.width,this.viewPortHandler.height,d),this.drawLeft(t,s,a,i,r,h,e),this.drawRight(t,s,a,i,n,c,e)}drawLeft(t,e,i,s,a,r,n){let o=0,l=0;t.beginPath(),t.lineWidth=2,t.moveTo(e,i),a.forEach((a,n)=>{o=e-parseInt(n)*r,l=i-a.t/s*i,t.lineTo(o,l)}),t.fillStyle=n.buyColor,t.strokeStyle=n.buyColor,t.stroke(),t.globalAlpha=n.globalAlpha,t.lineTo(0,l),t.lineTo(0,i),t.lineTo(e,i),t.fill(),t.closePath()}drawRight(t,e,i,s,a,r,n){let o=0,l=0;t.beginPath(),t.globalAlpha=1,t.lineWidth=n.lineWidth,t.moveTo(e+this.interval,i),a.forEach((a,n)=>{o=e+this.interval+parseInt(n)*r+1,l=i-a.t/s*i,t.lineTo(o,l)}),t.fillStyle=n.sellColor,t.strokeStyle=n.sellColor,t.shadowColor="none",t.stroke(),t.globalAlpha=n.globalAlpha,t.lineTo(2*e+this.interval,l),t.lineTo(2*e+this.interval,i),t.lineTo(e+this.interval,i),t.fill(),t.closePath()}drawBg(t,e,i,s){t.beginPath(),t.globalAlpha=1,t.fillStyle=s,t.fillRect(0,0,e,i),t.closePath()}}var g=m;class P extends o{constructor(t,e,i,s){super(t),this.style=s,this.xAxisRender=new u(this.viewPortHandler,e,i),this.yAxisRender=new v(this.viewPortHandler,e,i),this.mainRender=new g(this.viewPortHandler,e,i)}draw(){const{xAxis:t,yAxis:e,depth:i}=this.style;this.mainRender.renderDraw(this.ctx,i),this.yAxisRender.renderAxisLine(this.ctx,e),this.yAxisRender.renderTickLines(this.ctx,e),this.xAxisRender.renderAxisLine(this.ctx,t),this.xAxisRender.renderTickLines(this.ctx,t,e)}}var x=P,w=i("c53a");class b extends h{constructor(t,e,i){super(t,e,i),this.interval=i,this.dataProvider=e,this.locale=w[this.dataProvider.getLocale()],this.priceDecimal=this.dataProvider.getPriceDecimal(),this.valueDecimal=this.dataProvider.getValueDecimal()}point(t,e,i,s){t.beginPath(),t.globalAlpha=.5,t.fillStyle=s,t.arc(e,i,12,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),t.globalAlpha=.8,t.fillStyle=s,t.arc(e,i,8,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),t.globalAlpha=1,t.fillStyle="rgba(255,255,255, 1)",t.arc(e,i,5,0,2*Math.PI),t.fill(),t.closePath()}popup(t,e,i,s,a){i=i>140?i-130:i+30;let r=a?e-160:e;t.beginPath(),t.globalAlpha=1,t.fillStyle=s,t.fillRect(e,i,4,100),t.closePath(),t.beginPath(),t.fillStyle=s,t.globalAlpha=.4,t.fillRect(r,i,160,100),t.closePath()}labelText(t,e,i,s,a,r){i=i>140?i:i+160;let n=a?e-140:e+20;t.beginPath(),t.font="14px SFCompactDisplay-Semibold,SFCompactDisplay",t.fillStyle=s,t.globalAlpha=.8,t.fillText(this.locale["price"],n,i-110),t.closePath(),t.beginPath(),t.font="14px bold",t.fillStyle="#fff",t.globalAlpha=1,t.fillText(`${r.p.toFixed(this.priceDecimal)}`,n,i-90),t.closePath(),t.beginPath(),t.font="14px bold",t.fillStyle=s,t.globalAlpha=.8,t.fillText(this.locale["sum"],n,i-65),t.closePath(),t.beginPath(),t.font="14px bold",t.fillStyle="#fff",t.globalAlpha=1,t.fillText(`${parseFloat(r.t).toFixed(this.valueDecimal)}`,n,i-45),t.closePath()}}var y=b;class k extends o{constructor(t,e,i,s){super(t),this.interval=i,this.dataProvider=e,this.maskRender=new y(this.viewPortHandler,e,i),this.style=s}draw(t){this.maxVol=this.dataProvider.maxVol();let e=this.viewPortHandler.contentRight(),i=this.viewPortHandler.contentBottom(),s=e/2,a=s-this.interval/2,r=s+this.interval/2;if(a<t&&t<r||t>e||t<0)return!1;let n=t>s,{depth:o}=this.style,l=n?o.sellColor:o.buyColor,h=a/200,c=Math.floor(t/h)||0,d=Math.floor(this.interval/h)||0,f=c>199?c-d:c,u=[];n?(u=this.dataProvider.rightData,f-=200):(u=this.dataProvider.leftData,f=199-f);let p=u[f];if(p){let e=i-p.t/this.maxVol*i;this.maskRender.point(this.ctx,t,e,l),this.maskRender.popup(this.ctx,t,e,l,n,p),this.maskRender.labelText(this.ctx,t,e,l,n,p)}}flush(t,e){this.clearCanvas(),this.draw(t,e)}}var D=k;class T{constructor(){this.data={},this.decimal=0,this.leftData=[],this.rightData=[]}init(t,e,i){this.data=t,this.length=200,this.decimal=e,this.locale=i,this.leftData=this.dataFill(this.data["bids"]||[],"bids"),this.rightData=this.dataFill(this.data["asks"]||[],"asks")}adjacent(){let t=this.data["bids"]||[],e=t.length,i=this.data["asks"]||[],s=i.length;if(e<1||s<1)return console.log("数据长度不够"),!1;let a=0,r=0;a=e>1?Math.abs(parseFloat(t[0].price)-parseFloat(t[e-1].price)):parseFloat(t[0].price),r=s>1?Math.abs(parseFloat(i[0].price)-parseFloat(i[s-1].price)):parseFloat(i[0].price);const n=Math.min(a,r);return n}getPriceDecimal(){return parseInt(this.decimal.price)}getValueDecimal(){return parseInt(this.decimal.value)}getLocale(){return this.locale}initDataLeft(t){let e=[],i=this.minPrice(),s=this.adjacent(),a=s/this.length,r=this.length,n=0;"asks"==t&&(i+=s);for(let o=0;o<r;o++){let t={p:i+a*o,v:0,t:n};e.push(t)}return"asks"==t?e:e.reverse()}dataFill(t,e){let i=this.initDataLeft(e),s=this.length,a=this.adjacent(),r=a/this.length,n=0;for(let o=0;o<s;o++){let e=i[o];t.forEach(t=>{Math.abs(e.p-t.price)<r&&(n+=parseFloat(t.volume),e.v=parseFloat(t.volume)),e.t=n.toFixed(8)})}return i}originalData(t,e){let i=[],s=this.minPrice(),a=this.adjacent(),r=s;"asks"==e&&(r=s+a);let n=a/this.length,o=this.length,l=0;for(let h=0;h<o;h++){let e={p:r+n*h,v:0,t:l};t.forEach(t=>{Math.abs(e.p-t.price)<n/2&&(l+=t.volume,e.v=t.volume,e.t=l)}),i.push(e)}return i}processingData(t){let e=0,i=[],s=this.maxPrice();if(t.length>0){let a=Object.keys(t[0]);return t.forEach(t=>{t.price>s||(e+=t[a[1]],t={p:t[a[0]],v:t[a[1]],t:e},i.push(t))}),i}return[]}maxPrice(){return 2*this.adjacent()+this.minPrice()}minPrice(){let t=this.data["bids"]&&this.data["bids"].length-1||0;return t>0?parseFloat(this.data["bids"][t].price):0}maxVol(){let t=this.leftData.length-1,e=this.rightData.length-1,i=Math.max(parseFloat(this.leftData[t].t),parseFloat(this.rightData[e].t));return i+i/8}}var A=T;function C(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0,t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1}class R{constructor(t,e,i){this.maskChart=t,this.dataProvider=e,this.viewPortHandler=i}mouseMove(t){let{offsetX:e,offsetY:i}=t;C(t),this.waitingForMouseMoveAnimationFrame||(this.waitingForMouseMoveAnimationFrame=!0,this.maskChart.flush(e,i),this.waitingForMouseMoveAnimationFrame=!1)}mouseLeave(t){C(t),this.maskChart.clearCanvas()}}var S=R,H=i("29ee");class L extends o{constructor(t){super(t.dom);let{dom:e,width:i,height:s,data:a,decimal:r,interval:n,style:o,locale:l}=t;this.dom=e,e.style.position="relative",e.style.height=`${s}px`,e.style.width=`${i}px`,this.width=i||this.dom.offsetWidth,this.height=s||this.height.offsetHeight,this.data=a||{},this.decimal={price:r&&r.price||3,value:r&&r.value||4},this.interval=n||2,this.style=this.deepObjectMerge(H,o),this.locale=l,this.throttle=null,this.onResize=null,this.dataProvider=new A,this.dataProvider.init(this.data,this.decimal,this.locale),this.mainChart=new x(this.dom,this.dataProvider,this.interval,this.style),this.mainChart.init(this.dom),this.maskChart=new D(this.dom,this.dataProvider,this.interval,this.style),this.maskChart.init(this.dom),this.calcChartDimensions(),this.initEvent()}initEvent(){const t=new S(this.maskChart,this.dataProvider,this.viewPortHandler);let e=this.dom;e.addEventListener("mousemove",e=>{t.mouseMove(e)}),e.addEventListener("mouseleave",e=>{t.mouseLeave(e)}),this.throttle=(t,e)=>{let i=0;return()=>{const s=Date.now();s-i>e&&(t(),i=s)}},this.onResize=this.throttle(()=>{this&&this.updata(this.data)},62.5),window.addEventListener("resize",this.onResize,!1)}updata(t,e){this.data=t,e&&(this.decimal=e),this.dataProvider.init(t,this.decimal,this.locale),this.mainChart.flush()}calcChartDimensions(){const t=this.calcXAxisHeight(),e=this.calcYAxisWidth(),i=this.width,s=this.height;let a=0,r=0;const n=0,o=t;"left"===this.style.yAxis.position?a=e:r=e,this.mainChart.setChartDimensions(0,i,s,a,r,n,o),this.maskChart.setChartDimensions(0,i,s,a,r,n,o)}calcXAxisHeight(){return this.style.xAxis.height}calcYAxisWidth(){return this.style.yAxis.width}deepObjectMerge(t,e){for(var i in e)t[i]=t[i]&&"[object Object]"===t[i].toString()?this.deepObjectMerge(t[i],e[i]):t[i]=e[i];return t}}var F=L,M=F;e["default"]=M}})}));
//# sourceMappingURL=depth-chart.umd.min.js.map